# EducationELLy GraphQL Application External Secret
# EducationELLy GraphQL uses MongoDB Atlas (separate database from EducationELLy)
# Prerequisites:
# 1. Create and apply a SecretStore (e.g., aws-secretstore.yaml)
# 2. Store secrets in external store:
#    - portfolio/educationelly-graphql/mongodb-uri
#    - portfolio/educationelly-graphql/jwt-secret
# 3. Apply this ExternalSecret: kubectl apply -f educationelly-graphql-externalsecret.yaml

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: educationelly-graphql-externalsecret
  namespace: default
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-secretstore  # Change to your SecretStore name
    kind: SecretStore

  target:
    name: educationelly-graphql-secret
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: educationelly-graphql
      data:
        MONGODB_URI: "{{ .mongodbUri }}"
        JWT_SECRET: "{{ .jwtSecret }}"

  data:
    - secretKey: mongodbUri
      remoteRef:
        key: portfolio/educationelly-graphql/mongodb-uri
    - secretKey: jwtSecret
      remoteRef:
        key: portfolio/educationelly-graphql/jwt-secret

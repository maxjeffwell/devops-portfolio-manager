# Generic Webhook SecretStore
# This can be used with any HTTP-based secret API, including:
# - Custom secret management APIs
# - MongoDB Atlas API
# - Redis Cloud API
# - Any service exposing secrets via HTTP

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: webhook-secretstore
  namespace: default
spec:
  provider:
    webhook:
      url: "https://api.example.com/secrets/{{ .remoteRef.key }}"
      method: GET
      headers:
        Authorization: "Bearer {{ .auth.token }}"
      result:
        jsonPath: "$.data.value"
      secrets:
        - name: auth
          secretRef:
            name: webhook-auth
            key: token

---
# MongoDB Atlas Webhook SecretStore Example
# Prerequisites:
# 1. Create MongoDB Atlas API key in Atlas UI
# 2. Create Kubernetes secret with API credentials:
#    kubectl create secret generic mongodb-atlas-api \
#      --from-literal=public-key=YOUR_PUBLIC_KEY \
#      --from-literal=private-key=YOUR_PRIVATE_KEY \
#      -n default

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: mongodb-atlas-secretstore
  namespace: default
spec:
  provider:
    webhook:
      url: "https://cloud.mongodb.com/api/atlas/v1.0/groups/{{ .groupId }}/clusters/{{ .clusterName }}"
      method: GET
      headers:
        Content-Type: "application/json"
      result:
        jsonPath: "$.connectionStrings.standardSrv"
      secrets:
        - name: auth
          secretRef:
            name: mongodb-atlas-api
            key: api-key

---
# Create webhook authentication secret
# kubectl create secret generic webhook-auth \
#   --from-literal=token=YOUR_API_TOKEN \
#   -n default

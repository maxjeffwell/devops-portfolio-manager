name: Build and Deploy Bookmarked

on:
  push:
    branches: [ main ]
    paths:
      - 'helm-charts/bookmarked/**'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
          - development
          - staging
          - production
      version:
        description: 'Version tag (leave empty for latest)'
        required: false
        type: string

permissions:
  contents: write
  packages: write

jobs:
  build-deploy:
    uses: ./.github/workflows/reusable-build-deploy.yml
    with:
      app-name: bookmarked
      app-display-name: Bookmarked
      helm-chart-path: helm-charts/bookmarked
      source-repo: maxjeffwell/bookmarks-react-hooks
      source-repo-ref: master
      image-name-backend: maxjeffwell/bookmarked-api
      image-name-frontend: maxjeffwell/bookmarked-client
      backend-context: ./source/server
      frontend-context: ./source
      frontend-dockerfile: ./source/Dockerfile
      build-target: production
      checkout-submodules: false
      version: ${{ inputs.version || '' }}
    secrets:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}

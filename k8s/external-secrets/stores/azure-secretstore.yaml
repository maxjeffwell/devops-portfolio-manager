# Azure Key Vault SecretStore
# Prerequisites:
# 1. Create Azure Key Vault
# 2. Create service principal or use managed identity
# 3. Create Kubernetes secret with Azure credentials:
#    kubectl create secret generic azure-credentials \
#      --from-literal=client-id=YOUR_CLIENT_ID \
#      --from-literal=client-secret=YOUR_CLIENT_SECRET \
#      -n default
# 4. Store secrets in Key Vault with names like:
#    - portfolio-bookmarked-database-url
#    - portfolio-bookmarked-jwt-secret
#    etc.

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: azure-secretstore
  namespace: default
spec:
  provider:
    azurekv:
      vaultUrl: "https://your-vault-name.vault.azure.net"
      tenantId: "your-tenant-id"
      authType: ServicePrincipal
      authSecretRef:
        clientId:
          name: azure-credentials
          key: client-id
        clientSecret:
          name: azure-credentials
          key: client-secret

---
# Alternative: Use Azure Managed Identity (No credentials needed in cluster)
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: azure-secretstore-mi
  namespace: default
spec:
  provider:
    azurekv:
      vaultUrl: "https://your-vault-name.vault.azure.net"
      authType: ManagedIdentity
      identityId: "/subscriptions/sub-id/resourcegroups/rg-name/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity-name"

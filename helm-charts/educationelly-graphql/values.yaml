replicaCount: 2
image:
  server:
    repository: maxjeffwell/educationelly-graphql-server
    tag: latest
    pullPolicy: Always
  client:
    repository: maxjeffwell/educationelly-graphql-client
    tag: latest
    pullPolicy: Always
service:
  server:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    nodePort: 30009
  client:
    type: NodePort
    port: 80
    targetPort: 80
    nodePort: 30010
resources:
  server:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  client:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
env:
  server:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "8000"
    - name: MONGODB_URI
      valueFrom:
        secretKeyRef:
          name: educationelly-graphql-secret
          key: MONGODB_URI
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: educationelly-graphql-secret
          key: JWT_SECRET
    # MongoDB Connection Pool Configuration
    - name: MONGODB_POOL_MIN_SIZE
      value: "10"
    - name: MONGODB_POOL_MAX_SIZE
      value: "50"
    - name: MONGODB_MAX_IDLE_TIME_MS
      value: "30000"
    - name: MONGODB_WAIT_QUEUE_TIMEOUT_MS
      value: "5000"
    - name: MONGODB_SERVER_SELECTION_TIMEOUT_MS
      value: "5000"
  client:
    - name: REACT_APP_GRAPHQL_URL
      value: "http://educationelly-graphql-server:8000/graphql"
serviceAccount:
  create: true
podSecurityContext:
  fsGroup: 2000
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1001
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10
readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 5

# ⚠️ CRITICAL SECURITY WARNING ⚠️
# NEVER commit real secrets to Git repositories!
# Use one of these secure alternatives:
#
# Option 1: External Secrets Operator (Recommended for production)
# externalSecret:
#   enabled: true
#   backendType: gcpSecretsManager  # or awsSecretsManager, azureKeyVault
#   projectID: your-project-id
#   data:
#     - key: educationelly-graphql-mongodb-uri
#       name: MONGODB_URI
#     - key: educationelly-graphql-jwt-secret
#       name: JWT_SECRET
#
# Option 2: Sealed Secrets (GitOps-friendly)
# kubectl create secret generic educationelly-graphql-secret \
#   --from-literal=MONGODB_URI='your-uri' \
#   --from-literal=JWT_SECRET='your-secret' \
#   --dry-run=client -o yaml | \
#   kubeseal -o yaml > sealed-secret.yaml
#
# Option 3: Helm values override at deploy time (for development)
# helm install educationelly-graphql . --set secret.data.MONGODB_URI='...' --set secret.data.JWT_SECRET='...'
#
# Cloud Database Configuration
# IMPORTANT: Replace these placeholders before deployment
secret:
  data:
    # Base64 encode your MongoDB Atlas connection string:
    # echo -n "mongodb+srv://user:pass@cluster.mongodb.net/educationelly-graphql" | base64
    MONGODB_URI: "REPLACE_WITH_BASE64_ENCODED_MONGODB_ATLAS_URI"

    # Base64 encode your JWT secret (use strong random string):
    # openssl rand -base64 32 | base64
    JWT_SECRET: "REPLACE_WITH_BASE64_ENCODED_JWT_SECRET"

# Ingress Configuration
ingress:
  enabled: true
  host: educationelly-graphql-k8s.el-jefe.me
  serverPaths:
    - /graphql

# MongoDB Connection Pool Configuration
# These settings prevent connection exhaustion under load
mongodb:
  pool:
    # Minimum number of connections to maintain
    minSize: 10
    # Maximum number of connections allowed
    maxSize: 50
    # Time (ms) before idle connections are closed
    maxIdleTimeMs: 30000
    # Timeout (ms) for waiting for available connection
    waitQueueTimeoutMs: 5000
    # Timeout (ms) for server selection
    serverSelectionTimeoutMs: 5000

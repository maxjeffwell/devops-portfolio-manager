# Bookmarked Application External Secret
# This syncs secrets from external secret store into Kubernetes Secret
# Prerequisites:
# 1. Create and apply a SecretStore (e.g., aws-secretstore.yaml)
# 2. Store secrets in external store with appropriate keys
# 3. Apply this ExternalSecret: kubectl apply -f bookmarked-externalsecret.yaml

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: bookmarked-externalsecret
  namespace: default
spec:
  # Refresh interval - how often to check for secret updates
  refreshInterval: 1h

  # Reference to SecretStore
  secretStoreRef:
    name: aws-secretstore  # Change to your SecretStore name (aws-secretstore, gcp-secretstore, etc.)
    kind: SecretStore

  # Target Kubernetes Secret to create/update
  target:
    name: bookmarked-secret
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: bookmarked
      # Optional: Transform or combine secrets
      data:
        DATABASE_URL: "{{ .databaseUrl }}"
        JWT_SECRET: "{{ .jwtSecret }}"

  # Data to fetch from external secret store
  data:
    - secretKey: databaseUrl
      remoteRef:
        key: portfolio/bookmarked/database-url  # Path in external store
    - secretKey: jwtSecret
      remoteRef:
        key: portfolio/bookmarked/jwt-secret

---
# Alternative configuration for MongoDB-based applications
# Use this template for apps that don't use PostgreSQL
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: bookmarked-externalsecret
#   namespace: default
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: mongodb-atlas-secretstore
#     kind: SecretStore
#   target:
#     name: bookmarked-secret
#     creationPolicy: Owner
#   data:
#     - secretKey: MONGODB_URI
#       remoteRef:
#         key: portfolio/bookmarked/mongodb-uri
#     - secretKey: JWT_SECRET
#       remoteRef:
#         key: portfolio/bookmarked/jwt-secret

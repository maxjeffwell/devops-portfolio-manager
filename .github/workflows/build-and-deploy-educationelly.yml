name: Build and Deploy Educationelly

on:
  push:
    branches: [ main ]
    paths:
      - 'helm-charts/educationelly/**'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
          - development
          - staging
          - production
      version:
        description: 'Version tag (leave empty for latest)'
        required: false
        type: string

jobs:
  build-deploy:
    uses: ./.github/workflows/reusable-build-deploy.yml
    with:
      app-name: educationelly
      app-display-name: Educationelly
      helm-chart-path: helm-charts/educationelly
      source-repo: maxjeffwell/educationELLy-Docker
      source-repo-ref: main
      image-name-backend: maxjeffwell/educationelly-api
      image-name-frontend: maxjeffwell/educationelly-client
      backend-context: ./source/full-stack-capstone-server
      frontend-context: ./source/full-stack-capstone-client
      build-target: production
      checkout-submodules: false
      version: ${{ inputs.version || '' }}
    secrets:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}

# Default values for Bookmarked application

replicaCount: 1

# Use Recreate strategy to avoid resource pressure during deploys
strategy:
  type: Recreate

image:
  server:
    repository: maxjeffwell/bookmarks-react-hooks-server
    tag: 20260202-121848-dcdafde
    pullPolicy: Always
  client:
    repository: maxjeffwell/bookmarks-react-hooks-client
    tag: 20260202-121848-dcdafde
    pullPolicy: Always

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: false
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8000"

podSecurityContext:
  fsGroup: 2000

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: false
  runAsUser: 1001

# Client-specific security context (nginx needs root for PID file)
securityContextClient:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: false

service:
  server:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    nodePort: 30001
  client:
    type: NodePort
    port: 80
    targetPort: 80
    nodePort: 30002

# Ingress Configuration
ingress:
  enabled: true
  host: bookmarked-k8s.el-jefe.me

resources:
  server:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  client:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

nodeSelector: {}
tolerations: []
affinity: {}

# Environment variables
env:
  server:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "8000"
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: bookmarked-secret
          key: DATABASE_URL
    # AI Feature Flags
    - name: AI_FEATURES_ENABLED
      value: "true"
    - name: AI_CACHE_ENABLED
      value: "true"
    - name: USE_LOCAL_AI
      value: "true"
    - name: LOCAL_AI_URL
      value: "http://shared-ai-gateway:8002"
    # OpenAI Configuration (not used when USE_LOCAL_AI=true)
    - name: OPENAI_API_KEY
      valueFrom:
        secretKeyRef:
          name: bookmarked-secret
          key: OPENAI_API_KEY
    - name: OPENAI_MODEL
      value: "gpt-4o-mini"
    - name: OPENAI_TEMPERATURE
      value: "0.4"
    - name: OPENAI_MAX_TOKENS
      value: "1000"
    # Redis Cache Configuration
    - name: REDIS_HOST
      value: "redis"
    - name: REDIS_PORT
      value: "6379"
    - name: REDIS_PASSWORD
      valueFrom:
        secretKeyRef:
          name: redis-secrets
          key: redis-password
    # Cloudflare Cache Configuration
    - name: CLOUDFLARE_API_TOKEN
      valueFrom:
        secretKeyRef:
          name: cloudflare-secrets
          key: api-token
    - name: CLOUDFLARE_ZONE_ID
      valueFrom:
        secretKeyRef:
          name: cloudflare-secrets
          key: zone-id
    - name: PUBLIC_URL
      value: "https://bookmarked-k8s.el-jefe.me"
    # Cache Invalidation API Key (for cross-deployment sync)
    - name: CACHE_INVALIDATION_API_KEY
      valueFrom:
        secretKeyRef:
          name: bookmarked-secret
          key: CACHE_INVALIDATION_API_KEY
    # JWT Authentication Secrets
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: bookmarked-secret
          key: JWT_SECRET
    - name: JWT_REFRESH_SECRET
      valueFrom:
        secretKeyRef:
          name: bookmarked-secret
          key: JWT_REFRESH_SECRET
  client:
    - name: REACT_APP_API_URL
      value: "http://bookmarked-server:8000"

livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 5

# Client-specific probes (nginx on port 80)
livenessProbeClient:
  tcpSocket:
    port: 80
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbeClient:
  tcpSocket:
    port: 80
  initialDelaySeconds: 5
  periodSeconds: 5

# Cloud Database Configuration
# ⚠️  SECURITY: Never commit real secrets to Git!
#
# Use one of these secure methods to provide secrets:
#
# Option 1: External Secrets Operator (Recommended for production)
#   Enable externalSecrets below and configure your secret store
#
# Option 2: Helm install with --set flags
#   helm install bookmarked . \
#     --set secret.data.DATABASE_URL=$(echo -n "your-connection-string" | base64) \
#     --set secret.data.JWT_SECRET=$(echo -n "your-jwt-secret" | base64)
#
# Option 3: Create secret manually before deployment
#   kubectl create secret generic bookmarked-secret \
#     --from-literal=DATABASE_URL='postgres://...' \
#     --from-literal=JWT_SECRET='your-secret'
#
secret:
  # Secrets managed externally - do not recreate
  # Set to false if creating secrets manually or using External Secrets
  create: false
  data:
    # Placeholder values - MUST be overridden at deploy time
    # echo -n "your-postgres-connection-string" | base64
    DATABASE_URL: "REPLACE_AT_DEPLOY_TIME"

# External Secrets configuration
externalSecrets:
  enabled: false

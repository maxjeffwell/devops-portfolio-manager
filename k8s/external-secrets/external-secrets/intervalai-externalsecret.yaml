# IntervalAI Application External Secret
# IntervalAI uses MongoDB (can be MongoDB Atlas or other cloud MongoDB)
# Prerequisites:
# 1. Create and apply a SecretStore (e.g., aws-secretstore.yaml)
# 2. Store secrets in external store:
#    - portfolio/intervalai/mongodb-uri
#    - portfolio/intervalai/jwt-secret
# 3. Apply this ExternalSecret: kubectl apply -f intervalai-externalsecret.yaml

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: intervalai-externalsecret
  namespace: default
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-secretstore  # Change to your SecretStore name
    kind: SecretStore

  target:
    name: intervalai-secret
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: intervalai
      data:
        MONGODB_URI: "{{ .mongodbUri }}"
        JWT_SECRET: "{{ .jwtSecret }}"

  data:
    - secretKey: mongodbUri
      remoteRef:
        key: portfolio/intervalai/mongodb-uri
    - secretKey: jwtSecret
      remoteRef:
        key: portfolio/intervalai/jwt-secret
